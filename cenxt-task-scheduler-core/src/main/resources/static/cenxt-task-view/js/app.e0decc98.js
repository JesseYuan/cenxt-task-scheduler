(function(t){function e(e){for(var n,s,i=e[0],l=e[1],c=e[2],p=0,d=[];p<i.length;p++)s=i[p],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return a.push.apply(a,c||[]),o()}function o(){for(var t,e=0;e<a.length;e++){for(var o=a[e],n=!0,i=1;i<o.length;i++){var l=o[i];0!==r[l]&&(n=!1)}n&&(a.splice(e--,1),t=s(s.s=o[0]))}return t}var n={},r={app:0},a=[];function s(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=n,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(o,n,function(e){return t[e]}.bind(null,n));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=l;a.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"0346":function(t,e,o){"use strict";var n=o("e248"),r=o.n(n);r.a},"2a80":function(t,e,o){},3706:function(t,e,o){"use strict";var n=o("2a80"),r=o.n(n);r.a},"56d7":function(t,e,o){"use strict";o.r(e);o("cadf"),o("551c"),o("f751"),o("097d");var n,r=o("2b0e"),a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("router-view",{staticClass:"container"})],1)},s=[],i={name:"app",data:function(){return{}},methods:{}},l=i,c=(o("0346"),o("2877")),u=Object(c["a"])(l,a,s,!1,null,"26fb7742",null),p=u.exports,d=o("8c4f"),f=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("Row",{staticClass:"container",attrs:{type:"flex",justify:"center",align:"middle"}},[o("Col",{attrs:{span:"8"}}),o("Col",{attrs:{span:"8"}},[o("div",{staticClass:"login-container"},[o("div",{staticClass:"login-title"},[t._v("登录")]),o("Form",{staticClass:"login-form"},[o("FormItem",[o("Input",{attrs:{size:"large",placeholder:"用户名"},on:{"on-enter":t.login},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1),o("FormItem",[o("Input",{attrs:{type:"password",size:"large",placeholder:"密码"},on:{"on-enter":t.login},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),o("FormItem",[o("Button",{attrs:{type:"success",size:"large",long:""},on:{click:t.login}},[t._v("登录")])],1)],1)],1)]),o("Col",{attrs:{span:"8"}})],1)],1)},m=[],h={storage:{local:{set:function(t,e){window.localStorage.setItem(t,e)},get:function(t){return window.localStorage.getItem(t)},remove:function(t){window.localStorage.removeItem(t)},clear:function(){window.localStorage.clear()}},session:{set:function(t,e){window.sessionStorage.setItem(t,e)},get:function(t){return window.sessionStorage.getItem(t)},remove:function(t){window.sessionStorage.removeItem(t)},clear:function(){window.sessionStorage.clear()}}},formatDate:function(t){if(void 0==t)return"";var e=new Date(t),o=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),a=e.getHours(),s=e.getMinutes(),i=e.getSeconds();n<10&&(n="0"+n),r<10&&(r="0"+r),a<10&&(a="0"+a),s<10&&(s="0"+s),i<10&&(i="0"+i);var l=o+"-"+n+"-"+r+" "+a+":"+s+":"+i;return l}},g=h,k=(o("a481"),o("f559"),o("bc3a")),w=o.n(k),y={server:"",getUrl:function(t){return t.startsWith("/")?y.server+t:t.startsWith("http")?t:y.server+"/"+t},get:function(t,e,o){w.a.get(y.getUrl(t)).then((function(t){e&&e(t.data)})).catch((function(t){y.handleError(t,o)}))},delete:function(t,e,o){w.a.delete(y.getUrl(t)).then((function(t){e&&e(t.data)})).catch((function(t){y.handleError(t,o)}))},post:function(t,e,o,n){w.a.post(y.getUrl(t),e).then((function(t){o&&o(t.data)})).catch((function(t){y.handleError(t,n)}))},handleError:function(t,e){console.error(t),t.response?(console.error(t.response),"401"==t.response.status?(e&&e({message:"未登录",code:401}),R.push("/login")):"403"==t.response.status?(e&&e({message:"无权访问",code:403}),"/"!=R.path&&R.replace("/")):e&&e({code:t.response.status,message:t.response.data})):e&&e({message:t.message,code:99})}},x=y,v={name:"app",data:function(){return{username:"",password:""}},methods:{login:function(){var t=this;x.post("/api/login",{username:this.username,password:this.password},(function(e){window.sessionStorage.setItem("ROLE",e),t.$router.push("/")}),(function(e){t.$Notice.error({title:"["+e.code+"] "+e.message})}))}}},b=v,I=(o("3706"),Object(c["a"])(b,f,m,!1,null,"0d5f8f23",null)),S=I.exports,T=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticStyle:{width:"100%",height:"40px"}},["ADMIN"==t.role?o("Button",{staticStyle:{float:"left"},attrs:{type:"success",icon:"md-add"},on:{click:t.onAddTask}},[t._v("新增任务")]):t._e(),o("Button",{staticStyle:{float:"right"},attrs:{type:"success",icon:"md-refresh"},on:{click:t.getTasks}},[t._v("刷新")])],1),o("Table",{attrs:{loading:t.loading,columns:t.columns,data:t.tasks,size:"small","highlight-row":"",border:"",stripe:""}}),o("TaskInfo",{attrs:{taskInfoProp:t.taskInfo},on:{"on-ok":t.getTasks},model:{value:t.taskModel,callback:function(e){t.taskModel=e},expression:"taskModel"}}),o("Modal",{attrs:{fullscreen:""},model:{value:t.execHistoryModal,callback:function(e){t.execHistoryModal=e},expression:"execHistoryModal"}},[o("p",{attrs:{slot:"header"},slot:"header"},[o("span",[t._v("执行记录（最近"+t._s(t.execHistorySize)+"条）")])]),o("Row",[o("Col",{attrs:{span:"8"}},[o("span",[t._v("名称：")]),o("span",[t._v(t._s(t.execHistoryTask.name))])]),o("Col",{attrs:{span:"16"}},[o("span",[t._v("描述：")]),o("span",[t._v(t._s(t.execHistoryTask.description))])])],1),o("Table",{attrs:{columns:t.execHistorycolumns,data:t.execHistory,size:"small","highlight-row":"",border:"",stripe:""}}),o("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)},_=[],$=(o("7f7f"),function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Modal",{attrs:{width:900,"mask-closable":!1,closable:!1},model:{value:t.taskModel,callback:function(e){t.taskModel=e},expression:"taskModel"}},[o("p",{attrs:{slot:"header"},slot:"header"},[t.taskInfo.id?o("span",[t._v("修改任务")]):o("span",[t._v("新建任务")])]),o("Form",{ref:"taskInfoValidate",attrs:{model:t.taskInfo,rules:t.taskInfoRules,"label-position":"left","label-width":120}},[o("Row",[o("Col",{attrs:{span:"10"}},[o("FormItem",{attrs:{label:"名称",prop:"name"}},[o("Select",{attrs:{placeholder:"名称",clearable:""},model:{value:t.taskInfo.name,callback:function(e){t.$set(t.taskInfo,"name",e)},expression:"taskInfo.name"}},t._l(t.jobs,(function(e){return o("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1)],1),o("Col",{attrs:{span:"13",offset:"1"}},[o("FormItem",{attrs:{label:"表达式",prop:"cronStr","label-width":70}},[o("Poptip",{staticStyle:{width:"100%"},attrs:{disabled:0==t.cronExplain.length,value:t.cronExplain.length>0,title:"接下来"+t.explainSize+"次的执行时间",placement:"bottom"}},[o("Input",{attrs:{placeholder:"Spring cron表达式，如：0/30 * * * * ? (每30秒执行一次)",clearable:"","show-word-limit":"",maxlength:"200"},model:{value:t.taskInfo.cronStr,callback:function(e){t.$set(t.taskInfo,"cronStr",e)},expression:"taskInfo.cronStr"}}),o("div",{attrs:{slot:"content"},slot:"content"},[t.cronExplain.length>0?o("table",{staticStyle:{"border-collapse":"collapse"},attrs:{border:"1",bordercolor:"#a0c6e5"}},[o("tbody",t._l(t.cronExplain,(function(e,n){return o("tr",{key:n,attrs:{value:e}},[o("td",{staticStyle:{padding:"0 10px"}},[t._v("第"+t._s(n+1)+"次")]),o("td",{staticStyle:{padding:"0 10px"}},[t._v(t._s(t._f("formatDate")(e)))])])})),0)]):o("span",{staticStyle:{color:"red"}},[t._v("无效的表达式")])])],1)],1)],1)],1),o("Row",[o("Col",{attrs:{span:"10"}},[o("FormItem",{attrs:{label:"下次执行时间",prop:"nextTime"}},[o("DatePicker",{attrs:{type:"datetime",placeholder:"下次执行时间",clearable:""},model:{value:t.taskInfo.nextTime,callback:function(e){t.$set(t.taskInfo,"nextTime",e)},expression:"taskInfo.nextTime"}})],1)],1),o("Col",{attrs:{span:"6",offset:"1"}},[o("FormItem",{attrs:{label:"超时时间(分)",prop:"expire"}},[o("InputNumber",{attrs:{min:1,placeholder:"超时时间（分）",clearable:""},model:{value:t.taskInfo.expire,callback:function(e){t.$set(t.taskInfo,"expire",e)},expression:"taskInfo.expire"}})],1)],1),o("Col",{attrs:{span:"6",offset:"1"}},[o("FormItem",{attrs:{label:"重试次数",prop:"retryTimes"}},[o("InputNumber",{attrs:{min:0,max:5,placeholder:"重试次数",clearable:""},model:{value:t.taskInfo.retryTimes,callback:function(e){t.$set(t.taskInfo,"retryTimes",e)},expression:"taskInfo.retryTimes"}})],1)],1)],1),o("Row",[o("FormItem",{attrs:{label:"描述",prop:"description"}},[o("Input",{attrs:{placeholder:"描述",type:"textarea",rows:2,clearable:"","show-word-limit":"",maxlength:"200"},model:{value:t.taskInfo.description,callback:function(e){t.$set(t.taskInfo,"description",e)},expression:"taskInfo.description"}})],1)],1),o("Row",[o("FormItem",{attrs:{label:"参数(JSON)",prop:"params"}},[o("Input",{attrs:{placeholder:"参数(JSON)",type:"textarea",rows:10,clearable:"","show-word-limit":"",maxlength:"4000"},model:{value:t.taskInfo.params,callback:function(e){t.$set(t.taskInfo,"params",e)},expression:"taskInfo.params"}})],1)],1)],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"success"},on:{click:t.onConfirm}},[t._v("确定")]),t.taskInfo.id?t._e():o("Button",{attrs:{type:"error"},on:{click:t.onClear}},[t._v("清空")]),o("Button",{on:{click:t.onCancel}},[t._v("取消")])],1)],1)}),M=[],O=o("7618"),E={data:function(){return{taskModel:!1,taskInfo:{},jobs:[],explainSize:5,cronExplain:[],taskInfoRules:{name:[{required:!0,message:"名称必填",trigger:"blur"}],cronStr:[{required:!0,message:"表达式必填",trigger:"blur"},{validator:function(t,e,o,r,a){var s=[];e?n.getCronExplain(e,(function(t){t||s.push(new Error("无效的表达式")),o(s)})):o(s)}}],nextTime:[{required:!0,type:"date",message:"下次执行时间必填",trigger:"blur"}],expire:[{required:!0,type:"integer",message:"超时时间必填",trigger:"blur"}],retryTimes:[{required:!0,type:"integer",message:"重试次数必填",trigger:"blur"}],description:[{required:!0,message:"描述必填",trigger:"blur"}],params:[{required:!0,message:"参数必填",trigger:"blur"},{validator:function(t,e,o,n,r){var a=[];try{var s=JSON.parse(e);"object"!=Object(O["a"])(s)&&a.push(new Error(Object(O["a"])(s)+"非JSON Object类型"))}catch(i){a.push(new Error("参数非JSON类型,错误信息:"+i.message))}o(a)}}]}}},filters:{formatDate:g.formatDate},props:{value:{type:Boolean,default:function(){return!1}},taskInfoProp:{type:Object,default:function(){return{}}}},created:function(){n=this,this.getJobs()},watch:{value:function(t){t&&(this.$refs.taskInfoValidate.resetFields(),this.cronExplain=[],this.taskInfo=JSON.parse(JSON.stringify(this.taskInfoProp))),this.taskModel=t}},methods:{getJobs:function(){var t=this;x.get("/api/jobs",(function(e){t.jobs=e}))},getCronExplain:function(t,e){var o=this;x.post("/api/cron-explain",{cronStr:t,size:this.explainSize},(function(t){o.cronExplain=t,t.length>0&&(o.taskInfo.nextTime=g.formatDate(t[0])),e&&e(t.length>0)}),(function(t){e&&e(!1)}))},onConfirm:function(){var t=this,e=this;e.$refs.taskInfoValidate.validate((function(o){o&&(e.taskInfo.params=JSON.stringify(JSON.parse(e.taskInfo.params),null,2),e.$Spin.show(),x.post("/api/admin/task",e.taskInfo,(function(){t.$emit("on-ok",e.taskInfo),e.$Spin.hide(),e.$Notice.success({title:"新增成功"}),t.$emit("input",!1),t.taskModel=!1}),(function(t){e.$Spin.hide(),e.$Notice.error({title:t.message})})))}))},onCancel:function(){this.taskModel=!1,this.$emit("input",!1)},onClear:function(){this.$refs.taskInfoValidate.resetFields(),this.taskInfo={}}}},C=E,j=(o("7b39"),Object(c["a"])(C,$,M,!1,null,null,null)),H=j.exports,N={components:{TaskInfo:H},data:function(){var t=this;return{tasks:[],role:"GUEST",loading:!1,execHistory:[],execHistoryTask:{},execHistorySize:18,execHistoryModal:!1,taskModel:!1,taskInfo:{},columns:[{title:"任务编号",key:"id",width:100,tooltip:!0,fixed:"left"},{title:"任务名称",key:"name",width:180,tooltip:!0,fixed:"left"},{title:"任务描述",key:"description",width:180,tooltip:!0},{title:"执行状态",key:"flag",width:100,render:function(t,e){var o="green",n="待执行";return 1==e.row.flag?(o="orange",n="执行中"):2==e.row.flag&&(o="red",n="执行失败"),t("span",{style:{color:o}},n)}},{title:"时间表达式",key:"cronStr",width:130,tooltip:!0},{title:"执行时间",key:"execTime",width:150,tooltip:!0,render:function(t,e){return t("span",g.formatDate(e.row.execTime))}},{title:"下次执行时间",key:"nextTime",width:150,tooltip:!0,render:function(t,e){return t("span",g.formatDate(e.row.nextTime))}},{title:"执行ip",key:"execIp",width:120,tooltip:!0},{title:"参数",key:"params",width:150,tooltip:!0},{title:"超时(分)",key:"expire",width:90,tooltip:!0},{title:"重试次数",key:"retryTimes",width:90,tooltip:!0},{title:"创建时间",key:"createTime",width:150,tooltip:!0,render:function(t,e){return t("span",g.formatDate(e.row.createTime))}},{title:"更新时间",key:"updateTime",width:150,tooltip:!0,render:function(t,e){return t("span",g.formatDate(e.row.updateTime))}},{title:"创建人",key:"creator",width:100,tooltip:!0},{title:"更新人",key:"updator",width:90,tooltip:!0},{title:"操作",width:330,align:"center",fixed:"right",render:function(e,o){var n=[];return"ADMIN"==t.role&&(n.push(e("Button",{props:{type:o.row.enabled?"error":"success",size:"small"},on:{click:function(){t.enableTask(o.row)}}},o.row.enabled?"禁用":"启用")),n.push(e("Button",{props:{type:"info",size:"small",icon:"md-create"},style:{marginLeft:"5px"},on:{click:function(){t.taskInfo=o.row,t.taskModel=!0}}},"编辑")),n.push(e("Button",{props:{type:"error",size:"small",icon:"md-trash"},style:{marginLeft:"5px"},on:{click:function(){t.deleteTask(o.row)}}},"删除"))),n.push(e("Button",{props:{type:"warning",size:"small",icon:"md-list"},style:{marginLeft:"5px"},on:{click:function(){t.getExecHistory(o.row)}}},"执行记录")),e("div",n)}}],execHistorycolumns:[{title:"序号",type:"index",width:70,fixed:"left"},{title:"执行编号",key:"execId",width:300,tooltip:!0},{title:"执行结果",key:"execResult",width:120,render:function(t,e){var o="red",n="失败";return 0==e.row.execResult?(o="green",n="成功"):1==e.row.execResult&&(o="orange",n="重试后成功"),t("span",{style:{color:o}},n)}},{title:"执行IP",key:"execIp",width:160,tooltip:!0},{title:"耗时",key:"cost",width:120,tooltip:!0,render:function(t,e){var o=Math.floor(e.row.cost/1e3/60<<0),n=Math.floor(e.row.cost/1e3%60);return t("span",o+"分"+n+"秒")}},{title:"执行时间",key:"execTime",width:150,tooltip:!0,render:function(t,e){return t("span",g.formatDate(e.row.execTime))}},{title:"结束时间",key:"finishTime",width:150,tooltip:!0,render:function(t,e){return t("span",g.formatDate(e.row.finishTime))}},{title:"执行信息",key:"execMessage",minWidth:160,tooltip:!0}]}},mounted:function(){this.getTasks(),this.role=window.sessionStorage.getItem("ROLE")},methods:{onAddTask:function(){this.taskInfo={expire:5,retryTimes:0,params:"{}"},this.taskModel=!0},deleteTask:function(t){var e=this;this.$Modal.confirm({title:"确定删除"+t.name,content:"删除"+t.name+" 编号："+t.id,onOk:function(){e.$Spin.show(),x.delete("/api/admin/task/"+t.id,(function(){e.$Spin.hide(),e.$Notice.success({title:"删除成功"}),e.getTasks()}),(function(t){e.$Spin.hide(),e.$Notice.error({title:t.message})}))}})},enableTask:function(t){var e=this,o="/api/admin/task/enabled/";t.enabled&&(o="/api/admin/task/disabled/"),this.$Spin.show(),x.post(o+t.id,{},(function(){e.$Spin.hide(),e.$Notice.success({title:"操作成功"}),e.getTasks()}),(function(t){e.$Spin.hide(),e.$Notice.error({title:t.message})}))},getTasks:function(){var t=this;this.loading=!0,x.get("/api/tasks",(function(e){t.tasks=e,t.loading=!1}),(function(e){t.loading=!1}))},getExecHistory:function(t){var e=this;this.$Spin.show(),this.execHistory=[],this.execHistoryTask=t,x.get("/api/exec-history/"+t.id+"/"+this.execHistorySize,(function(t){e.execHistory=t,e.execHistoryModal=!0,e.$Spin.hide()}),(function(t){e.$Spin.hide()}))}}},z=N,D=Object(c["a"])(z,T,_,!1,null,"04537698",null),F=D.exports;r["default"].use(d["a"]);var J=[{path:"/",name:"index",component:F},{path:"/login",name:"login",component:S}],P=new d["a"]({routes:J}),R=P,B=o("f825"),q=o.n(B);o("f8ce");r["default"].use(q.a),w.a.defaults.withCredentials=!1,r["default"].config.productionTip=!1,new r["default"]({router:R,render:function(t){return t(p)}}).$mount("#app")},"7b39":function(t,e,o){"use strict";var n=o("ec31"),r=o.n(n);r.a},e248:function(t,e,o){},ec31:function(t,e,o){}});